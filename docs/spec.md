# ToriYomi â€” ê¸°ìˆ  ëª…ì„¸ì„œ (Technical Specification)

**ë²„ì „**: 1.0  
**ì‘ì„±ì¼**: 2025-11-10  
**ëŒ€ìƒ**: MVP (Minimum Viable Product)

---

## ğŸ“‹ ëª©ì°¨
1. [í”„ë¡œì íŠ¸ ê°œìš”](#í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ì„¤ê³„](#ì•„í‚¤í…ì²˜-ì„¤ê³„)
3. [ê¸°ëŠ¥ ëª…ì„¸](#ê¸°ëŠ¥-ëª…ì„¸)
4. [ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­](#ì„±ëŠ¥-ìš”êµ¬ì‚¬í•­)
5. [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
6. [ê°œë°œ ê°€ì´ë“œë¼ì¸](#ê°œë°œ-ê°€ì´ë“œë¼ì¸)
7. [í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­](#í…ŒìŠ¤íŠ¸-ìš”êµ¬ì‚¬í•­)
8. [ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­](#ë¹„ê¸°ëŠ¥-ìš”êµ¬ì‚¬í•­)

---

## í”„ë¡œì íŠ¸ ê°œìš”

### ëª©ì 
ToriYomiëŠ” ì¼ë³¸ì–´ ê²Œì„ í”Œë ˆì´ ì¤‘ ì‹¤ì‹œê°„ìœ¼ë¡œ í•œìì— í›„ë¦¬ê°€ë‚˜ë¥¼ ì˜¤ë²„ë ˆì´í•˜ì—¬ ì½ê¸°ë¥¼ ë•ê³ , ë¬¸ì¥ì„ ì €ì¥Â·ì‚¬ì „ ê²€ìƒ‰Â·Anki ë‚´ë³´ë‚´ê¸°ë¥¼ ì œê³µí•˜ëŠ” í•™ìŠµ ë„êµ¬ì…ë‹ˆë‹¤.

### í•µì‹¬ ê°€ì¹˜
- **ì‹¤ì‹œê°„ í›„ë¦¬ê°€ë‚˜**: ê²Œì„ í™”ë©´ì—ì„œ í•œì ìœ„ì—ë§Œ í›„ë¦¬ê°€ë‚˜ í‘œì‹œ
- **ë¹„ê°„ì„­ ì˜¤ë²„ë ˆì´**: í´ë¦­ íˆ¬ê³¼, ê²Œì„ í”Œë ˆì´ ë°©í•´ ì—†ìŒ
- **í•™ìŠµ ì›Œí¬í”Œë¡œìš°**: ë¬¸ì¥ ì €ì¥ â†’ ì‚¬ì „ ê²€ìƒ‰ â†’ Anki ì¹´ë“œ ì¶”ê°€

### ë¹„ëª©í‘œ (MVP ë²”ìœ„ ì™¸)
- âŒ ê²Œì„ í™”ë©´ ë‚´ ë²ˆì—­ í…ìŠ¤íŠ¸
- âŒ ê²Œì„ í™”ë©´ ë‚´ ì‚¬ì „ íŒì—… (í´ë¦­ ìƒí˜¸ì‘ìš©)
- âŒ TTS ìŒì„± ì¬ìƒ
- âŒ QML ê¸°ë°˜ UI

---

## ì•„í‚¤í…ì²˜ ì„¤ê³„

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ToriYomi System                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Game Window  â”‚â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ CaptureThreadâ”‚                  â”‚
â”‚  â”‚  (Target)    â”‚  DXGI   â”‚   (â‰¥30 FPS)  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                   â”‚                           â”‚
â”‚                                   v                           â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                           â”‚ FrameQueue   â”‚                   â”‚
â”‚                           â”‚ (Threadsafe) â”‚                   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                   â”‚                           â”‚
â”‚                                   v                           â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                           â”‚  OcrThread   â”‚                   â”‚
â”‚                           â”‚  (Tesseract) â”‚                   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                   â”‚                           â”‚
â”‚                                   v                           â”‚
â”‚                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                           â”‚  Tokenizer   â”‚                   â”‚
â”‚                           â”‚ (Kanji->è¯»)  â”‚                   â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                   â”‚                           â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                v                                        v     â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚        â”‚   Overlay    â”‚                      â”‚  Main App    â”‚â”‚
â”‚        â”‚   Window     â”‚                      â”‚  (Qt Widget) â”‚â”‚
â”‚        â”‚ (Furigana)   â”‚                      â”‚              â”‚â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚ - Sentence   â”‚â”‚
â”‚                                               â”‚   List       â”‚â”‚
â”‚                                               â”‚ - Dictionary â”‚â”‚
â”‚                                               â”‚ - Anki Btn   â”‚â”‚
â”‚                                               â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                      â”‚         â”‚
â”‚                                                      v         â”‚
â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                                              â”‚ AnkiConnect  â”‚ â”‚
â”‚                                              â”‚   (HTTP)     â”‚ â”‚
â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìŠ¤ë ˆë“œ ëª¨ë¸

| ìŠ¤ë ˆë“œ | ì—­í•  | ìš°ì„ ìˆœìœ„ |
|--------|------|----------|
| **Main Thread** | Qt UI ì´ë²¤íŠ¸ ë£¨í”„, ì‚¬ìš©ì ìƒí˜¸ì‘ìš© | Normal |
| **CaptureThread** | í™”ë©´ ìº¡ì²˜ (DXGI), FrameQueue í‘¸ì‹œ | High |
| **OcrThread** | FrameQueue ì†Œë¹„, OCR ì²˜ë¦¬, í† í°í™” | Normal |
| **OverlayRenderThread** | ì˜¤ë²„ë ˆì´ ì°½ ë Œë”ë§ (16ms ì£¼ê¸°) | High |

### ëª¨ë“ˆ êµ¬ì¡°

```
src/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ capture/
â”‚   â”‚   â”œâ”€â”€ dxgi_capture.h/cpp      # DXGI í™”ë©´ ìº¡ì²˜
â”‚   â”‚   â”œâ”€â”€ gdi_capture.h/cpp       # GDI í´ë°±
â”‚   â”‚   â””â”€â”€ frame_queue.h/cpp       # ìŠ¤ë ˆë“œ ì•ˆì „ í”„ë ˆì„ í
â”‚   â”œâ”€â”€ ocr/
â”‚   â”‚   â”œâ”€â”€ tesseract_wrapper.h/cpp # Tesseract API ë˜í¼
â”‚   â”‚   â””â”€â”€ text_segment.h          # OCR ê²°ê³¼ êµ¬ì¡°ì²´
â”‚   â””â”€â”€ tokenizer/
â”‚       â”œâ”€â”€ japanese_tokenizer.h/cpp # í˜•íƒœì†Œ ë¶„ì„
â”‚       â””â”€â”€ furigana_mapper.h/cpp    # í•œìâ†’ì½ê¸° ë§¤í•‘
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ overlay/
â”‚   â”‚   â”œâ”€â”€ overlay_window.h/cpp    # íˆ¬ëª… ì˜¤ë²„ë ˆì´ ì°½
â”‚   â”‚   â””â”€â”€ furigana_renderer.h/cpp # í›„ë¦¬ê°€ë‚˜ ë Œë”ë§
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ main_window.h/cpp       # Qt .ui ë¡œë”
â”‚       â”œâ”€â”€ sentence_list_widget.h/cpp
â”‚       â””â”€â”€ dictionary_widget.h/cpp
â”œâ”€â”€ dict/
â”‚   â”œâ”€â”€ dictionary.h/cpp            # ë¡œì»¬ ì‚¬ì „ ì¸í„°í˜ì´ìŠ¤
â”‚   â””â”€â”€ dict_entry.h                # ì‚¬ì „ í•­ëª© êµ¬ì¡°ì²´
â””â”€â”€ anki/
    â””â”€â”€ anki_connect_client.h/cpp   # AnkiConnect HTTP í´ë¼ì´ì–¸íŠ¸
```

---

## ê¸°ëŠ¥ ëª…ì„¸

### 1. í™”ë©´ ìº¡ì²˜ ëª¨ë“ˆ

#### 1.1 DXGI ìº¡ì²˜ (`dxgi_capture`)
- **ì…ë ¥**: ëŒ€ìƒ ìœˆë„ìš° í•¸ë“¤ (HWND)
- **ì¶œë ¥**: BGR í”„ë ˆì„ (`cv::Mat`)
- **ìš”êµ¬ì‚¬í•­**:
  - DirectX 11 Desktop Duplication API ì‚¬ìš©
  - í”„ë ˆì„ ë ˆì´íŠ¸: â‰¥ 30 FPS
  - ì—ëŸ¬ ì²˜ë¦¬: DXGI ì‹¤íŒ¨ ì‹œ GDI í´ë°±
- **ì¸í„°í˜ì´ìŠ¤**:
  ```cpp
  class DxgiCapture {
  public:
      bool Initialize(HWND targetWindow);
      cv::Mat CaptureFrame();  // ë¸”ë¡œí‚¹, íƒ€ì„ì•„ì›ƒ 100ms
      void Shutdown();
  };
  ```

#### 1.2 í”„ë ˆì„ í (`frame_queue`)
- **ëª©ì **: CaptureThreadì™€ OcrThread ê°„ í”„ë ˆì„ ë²„í¼
- **ìš”êµ¬ì‚¬í•­**:
  - ìŠ¤ë ˆë“œ ì•ˆì „ (`std::mutex`)
  - í í¬ê¸°: 5 í”„ë ˆì„ (ë©”ëª¨ë¦¬ ì œí•œ)
  - í ê°€ë“ ì°¸ ì‹œ: ê°€ì¥ ì˜¤ë˜ëœ í”„ë ˆì„ ì‚­ì œ
- **ì¸í„°í˜ì´ìŠ¤**:
  ```cpp
  class FrameQueue {
  public:
      void Push(cv::Mat frame);
      std::optional<cv::Mat> Pop(int timeoutMs);
      size_t Size() const;
  };
  ```

#### 1.3 ë³€ê²½ ê°ì§€
- **ëª©ì **: ë™ì¼ í”„ë ˆì„ ë°˜ë³µ ì‹œ OCR ìŠ¤í‚µ â†’ CPU ì ˆì•½
- **ë°©ë²•**: ì´ì „ í”„ë ˆì„ê³¼ íˆìŠ¤í† ê·¸ë¨ ë¹„êµ (OpenCV `compareHist`)
- **ì„ê³„ê°’**: ìœ ì‚¬ë„ > 0.95 â†’ OCR ìŠ¤í‚µ

---

### 2. OCR ëª¨ë“ˆ

#### 2.1 Tesseract ë˜í¼ (`tesseract_wrapper`)
- **ì…ë ¥**: `cv::Mat` (ê·¸ë ˆì´ìŠ¤ì¼€ì¼ ê¶Œì¥)
- **ì¶œë ¥**: `std::vector<TextSegment>`
  ```cpp
  struct TextSegment {
      std::string text;          // ì¶”ì¶œëœ í…ìŠ¤íŠ¸
      cv::Rect boundingBox;      // í™”ë©´ ì¢Œí‘œ
      float confidence;          // ì‹ ë¢°ë„ (0.0~1.0)
  };
  ```
- **ìš”êµ¬ì‚¬í•­**:
  - Tesseract ì–¸ì–´: `jpn` (ì¼ë³¸ì–´ ëª¨ë¸)
  - PSM ëª¨ë“œ: `PSM_AUTO` ë˜ëŠ” `PSM_SPARSE_TEXT`
  - ì „ì²˜ë¦¬: ì´ì§„í™” (Otsu's method) ì˜µì…˜ ì œê³µ

#### 2.2 ì„±ëŠ¥ ìµœì í™”
- ROI ê¸°ë°˜ OCR (ê´€ì‹¬ ì˜ì—­ë§Œ ì²˜ë¦¬)
- ë³‘ë ¬ ì²˜ë¦¬ ì˜µì…˜ (ë©€í‹° ROI)

---

### 3. í† í¬ë‚˜ì´ì € ëª¨ë“ˆ

#### 3.1 ì¼ë³¸ì–´ í† í¬ë‚˜ì´ì € (`japanese_tokenizer`)
- **ì…ë ¥**: OCR í…ìŠ¤íŠ¸ (UTF-8 `std::string`)
- **ì¶œë ¥**: `std::vector<Token>`
  ```cpp
  struct Token {
      std::string surface;       // í‘œë©´í˜• (ì˜ˆ: "é£Ÿã¹ã‚‹")
      std::string reading;       // ì½ê¸° (ì˜ˆ: "ãŸã¹ã‚‹")
      TokenType type;            // KANJI, HIRAGANA, KATAKANA, OTHER
      size_t startPos;           // ì›ë³¸ í…ìŠ¤íŠ¸ ë‚´ ìœ„ì¹˜
  };
  ```
- **êµ¬í˜„ ì˜µì…˜**:
  - **MeCab** (ì¶”ì²œ): í˜•íƒœì†Œ ë¶„ì„ + ì½ê¸° ì‚¬ì „
  - **ì‚¬ì „ ë§¤ì¹­**: ê°„ë‹¨í•œ í•œìâ†’ì½ê¸° JSON ì‚¬ì „

#### 3.2 í›„ë¦¬ê°€ë‚˜ ë§¤í¼ (`furigana_mapper`)
- **ì…ë ¥**: `std::vector<Token>`
- **ì¶œë ¥**: `std::vector<FuriganaSegment>`
  ```cpp
  struct FuriganaSegment {
      std::string kanji;         // í•œì (ì˜ˆ: "é£Ÿ")
      std::string furigana;      // í›„ë¦¬ê°€ë‚˜ (ì˜ˆ: "ãŸ")
      cv::Point position;        // ì˜¤ë²„ë ˆì´ ì¢Œí‘œ
  };
  ```
- **ê·œì¹™**:
  - í•œìë§Œ í›„ë¦¬ê°€ë‚˜ ìƒì„± (íˆë¼ê°€ë‚˜/ê°€íƒ€ì¹´ë‚˜ ì œì™¸)
  - ìœ„ì¹˜ ê³„ì‚°: `boundingBox.tl() + offset`

---

### 4. ì˜¤ë²„ë ˆì´ UI

#### 4.1 ì˜¤ë²„ë ˆì´ ì°½ (`overlay_window`)
- **ëª©ì **: ê²Œì„ í™”ë©´(OCR ì†ŒìŠ¤) ìœ„ì— **í›„ë¦¬ê°€ë‚˜ë§Œ** í‘œì‹œí•˜ëŠ” íˆ¬ëª… ìœˆë„ìš°
- **ì†ì„±**:
  - ìµœìƒìœ„ ìœˆë„ìš° (`WS_EX_TOPMOST`)
  - ì™„ì „ íˆ¬ëª… ë°°ê²½ (`SetLayeredWindowAttributes`)
  - í´ë¦­ íˆ¬ê³¼ (`WS_EX_TRANSPARENT`) - ê²Œì„ ì¡°ì‘ ë°©í•´í•˜ì§€ ì•ŠìŒ
- **ë Œë”ë§**:
  - **í•œì ìœ„ì¹˜ì— í›„ë¦¬ê°€ë‚˜ë§Œ í‘œì‹œ** (ì›ë³¸ í…ìŠ¤íŠ¸ëŠ” í‘œì‹œí•˜ì§€ ì•ŠìŒ)
  - GDI+ ë˜ëŠ” Direct2Dë¡œ ë£¨ë¹„ í…ìŠ¤íŠ¸ ë Œë”ë§
  - í°íŠ¸: ì¼ë³¸ì–´ ê³ ë”•ì²´ (ì˜ˆ: "Yu Gothic", "Meiryo")
  - í¬ê¸°: ì‘ê³  ì½ê¸° ì‰¬ìš´ í¬ê¸° (8~12pt ê¶Œì¥)
  - ìŠ¤íƒ€ì¼: ê²€ì€ìƒ‰ í…ìŠ¤íŠ¸ + í°ìƒ‰ ì™¸ê³½ì„  (ê°€ë…ì„±)

#### 4.2 ë Œë”ë§ ë£¨í”„
- **ì£¼ê¸°**: 16ms (â‰ˆ60 FPS)
- **ë°ì´í„° ì†ŒìŠ¤**: `FuriganaMapper`ì—ì„œ ìƒì„±í•œ `FuriganaInfo` ë¦¬ìŠ¤íŠ¸
- **ë Œë”ë§ ì¡°ê±´**: `needsRuby == true`ì¸ í•­ëª©ë§Œ ë Œë”ë§ (í•œìë§Œ)
- **ìŠ¤ë ˆë“œ ì•ˆì „**: `std::mutex`ë¡œ í›„ë¦¬ê°€ë‚˜ ë°ì´í„° ë™ê¸°í™”

---

### 5. ë°ìŠ¤í¬í†± ì•± UI (Qt Widgets)

#### 5.1 UI êµ¬ì„±
- **ëª©ì **: ê²Œì„ í™”ë©´ê³¼ **ë¶„ë¦¬ëœ ë³„ë„ ìœˆë„ìš°**ì—ì„œ í•™ìŠµ ê¸°ëŠ¥ ì œê³µ
- **ì—­í• **: ë¬¸ì¥ ê´€ë¦¬, ë‹¨ì–´ ì‚¬ì „, Anki ì—°ë™ ë“±
- **Qt Designer (.ui íŒŒì¼)** ì‚¬ìš© í•„ìˆ˜
- C++ ì½”ë“œëŠ” `.ui` ë¡œë“œë§Œ ë‹´ë‹¹:
  ```cpp
  QUiLoader loader;
  QFile file("main_window.ui");
  QWidget* mainWindow = loader.load(&file);
  ```

#### 5.2 ë¬¸ì¥ ë¦¬ìŠ¤íŠ¸ (`sentence_list_widget`)
- **ê¸°ëŠ¥**:
  - OCR ì¶”ì¶œ ë¬¸ì¥ ëª©ë¡ í‘œì‹œ (`QListWidget`)
  - í›„ë¦¬ê°€ë‚˜ í¬í•¨ í‘œì‹œ (ì›ë³¸ + ì½ê¸°)
  - ë”ë¸”í´ë¦­ â†’ í•´ë‹¹ ë¬¸ì¥ í•˜ì´ë¼ì´íŠ¸
- **ì €ì¥**:
  - ì„¸ì…˜ ì¤‘ ë©”ëª¨ë¦¬ ì €ì¥
  - ì˜µì…˜: SQLiteì— ì˜êµ¬ ì €ì¥

#### 5.3 ë‹¨ì–´ ìƒí˜¸ì‘ìš©
- **í˜¸ë²„ (Hover)**:
  - `QListWidget::itemEntered` ì‹œê·¸ë„
  - í•´ë‹¹ ë‹¨ì–´ ë°°ê²½ ìƒ‰ìƒ ë³€ê²½
- **í´ë¦­**:
  - `QListWidget::itemClicked` ì‹œê·¸ë„
  - ì‚¬ì „ íŒ¨ë„ë¡œ ë‹¨ì–´ ì „ë‹¬

#### 5.4 ì‚¬ì „ íŒ¨ë„ (`dictionary_widget`)
- **í‘œì‹œ ë‚´ìš©**:
  - ë‹¨ì–´ (è¡¨å±¤å½¢)
  - ì½ê¸° (ä»®å)
  - ì˜ë¯¸ (í•œêµ­ì–´/ì˜ì–´)
  - ì˜ˆë¬¸ (ì„ íƒ ì‚¬í•­)
- **ë°ì´í„° ì†ŒìŠ¤**: ë¡œì»¬ JSON ì‚¬ì „

#### 5.5 Anki ì¶”ê°€ ë²„íŠ¼
- **ìœ„ì¹˜**: ì‚¬ì „ íŒ¨ë„ í•˜ë‹¨
- **ë™ì‘**:
  1. í˜„ì¬ ë‹¨ì–´ + ì˜ë¯¸ + ì¶œì²˜ ë¬¸ì¥ ìˆ˜ì§‘
  2. `AnkiConnectClient::AddCard()` í˜¸ì¶œ
  3. ì„±ê³µ/ì‹¤íŒ¨ í† ìŠ¤íŠ¸ í‘œì‹œ

---

### 6. ì‚¬ì „ ëª¨ë“ˆ

#### 6.1 ì‚¬ì „ íŒŒì¼ í˜•ì‹
```json
{
  "entries": [
    {
      "word": "é£Ÿã¹ã‚‹",
      "reading": "ãŸã¹ã‚‹",
      "meanings": ["ë¨¹ë‹¤", "eat"],
      "examples": [
        {
          "jp": "ã”é£¯ã‚’é£Ÿã¹ã‚‹",
          "kr": "ë°¥ì„ ë¨¹ë‹¤"
        }
      ]
    }
  ]
}
```

#### 6.2 ì¸í„°í˜ì´ìŠ¤
```cpp
class Dictionary {
public:
    bool Load(const std::string& jsonPath);
    std::optional<DictEntry> Lookup(const std::string& word);
};
```

---

### 7. Anki í†µí•© ëª¨ë“ˆ

#### 7.1 AnkiConnect HTTP í´ë¼ì´ì–¸íŠ¸
- **ìš”êµ¬ì‚¬í•­**:
  - AnkiConnect í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ í•„ìš” (ì‚¬ìš©ì ì±…ì„)
  - ê¸°ë³¸ í¬íŠ¸: `http://localhost:8765`
- **API ì˜ˆì‹œ**:
  ```json
  {
    "action": "addNote",
    "version": 6,
    "params": {
      "note": {
        "deckName": "Japanese::ToriYomi",
        "modelName": "Basic",
        "fields": {
          "Front": "é£Ÿã¹ã‚‹ [ãŸã¹ã‚‹]",
          "Back": "ë¨¹ë‹¤\n\nSentence: ã”é£¯ã‚’é£Ÿã¹ã‚‹"
        }
      }
    }
  }
  ```

#### 7.2 ì¸í„°í˜ì´ìŠ¤
```cpp
class AnkiConnectClient {
public:
    bool IsConnected();  // AnkiConnect ì‘ë‹µ í™•ì¸
    bool AddCard(const AnkiCard& card);
};

struct AnkiCard {
    std::string word;
    std::string reading;
    std::string meaning;
    std::string sentence;
};
```

---

## ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­

### ë ˆì´í„´ì‹œ íƒ€ê²Ÿ

| íŒŒì´í”„ë¼ì¸ ë‹¨ê³„ | ìµœëŒ€ í—ˆìš© ì‹œê°„ |
|------------------|----------------|
| í™”ë©´ ìº¡ì²˜ â†’ FrameQueue | 33ms (30 FPS) |
| OCR ì²˜ë¦¬ (Tesseract) | 150ms |
| í† í°í™” + ë§¤í•‘ | 20ms |
| **ì´ ë ˆì´í„´ì‹œ (ìº¡ì²˜â†’ì˜¤ë²„ë ˆì´)** | **â‰¤ 200ms** |
| ì˜¤ë²„ë ˆì´ ë Œë”ë§ ì£¼ê¸° | **â‰¤ 16ms (60 FPS)** |

### ìì› ì‚¬ìš©ëŸ‰

| í•­ëª© | íƒ€ê²Ÿ | ì¸¡ì • ë°©ë²• |
|------|------|-----------|
| CPU ì‚¬ìš©ë¥  (í‰ê· ) | â‰¤ 30% | Task Manager (4ì½”ì–´ ê¸°ì¤€) |
| ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ | â‰¤ 300MB | Private Bytes (Process Explorer) |
| GPU ì‚¬ìš©ë¥  | â‰¤ 5% | DXGI ìº¡ì²˜ë§Œ ì‚¬ìš© |

### ìµœì í™” ëª©í‘œ

- **OCR ìŠ¤í‚µë¥ **: ë³€ê²½ ì—†ëŠ” í”„ë ˆì„ â‰¥ 90% ìŠ¤í‚µ
- **í”„ë ˆì„ ë“œë¡­**: FrameQueue ì˜¤ë²„í”Œë¡œìš° < 1%

---

## ê¸°ìˆ  ìŠ¤íƒ

### í”„ë¡œê·¸ë˜ë° ì–¸ì–´
- **C++20** (í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬, ëª¨ë˜ ê¸°ëŠ¥ í™œìš©)

### ë¹Œë“œ ì‹œìŠ¤í…œ
- **CMake 3.20+**
- **MSVC 2022** (Windows), GCC/Clang (Linux í–¥í›„ ì§€ì›)

### í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬

| ë¼ì´ë¸ŒëŸ¬ë¦¬ | ë²„ì „ | ìš©ë„ |
|-----------|------|------|
| **Qt 6 Widgets** | 6.5+ | ë°ìŠ¤í¬í†± UI (.ui ë¡œë”) |
| **Tesseract OCR** | 5.0+ | ì¼ë³¸ì–´ OCR |
| **OpenCV** | 4.8+ | ì´ë¯¸ì§€ ì²˜ë¦¬, ë³€ê²½ ê°ì§€ |
| **spdlog** | 1.12+ | êµ¬ì¡°í™”ëœ ë¡œê¹… |
| **nlohmann/json** | 3.11+ | JSON íŒŒì‹± (ì‚¬ì „) |
| **cpr** | 1.10+ | HTTP í´ë¼ì´ì–¸íŠ¸ (AnkiConnect) |

### Windows API
- **DXGI** (DirectX 11): í™”ë©´ ìº¡ì²˜
- **Win32 API**: ì˜¤ë²„ë ˆì´ ìœˆë„ìš°, í´ë¦­ íˆ¬ê³¼

### ì„ íƒì  ë¼ì´ë¸ŒëŸ¬ë¦¬
- **MeCab** (ì¼ë³¸ì–´ í˜•íƒœì†Œ ë¶„ì„)
- **SQLite** (ë¬¸ì¥ ì˜êµ¬ ì €ì¥)

---

## ê°œë°œ ê°€ì´ë“œë¼ì¸

### ì½”ë“œ ìŠ¤íƒ€ì¼ (ìš”ì•½)
ìì„¸í•œ ë‚´ìš©ì€ [`docs/code-style.md`](./code-style.md) ì°¸ì¡°

- **C++20** ê¸°ëŠ¥ ì ê·¹ í™œìš© (`std::optional`, `std::span`, concepts)
- **ë“¤ì—¬ì“°ê¸°**: íƒ­ (TabWidth=4)
- **ë„¤ì´ë°**:
  - í´ë˜ìŠ¤/í•¨ìˆ˜: `PascalCase`
  - ë³€ìˆ˜: `camelCase`
  - ìƒìˆ˜: `kPascalCase`
- **RAII**: ìŠ¤ë§ˆíŠ¸ í¬ì¸í„° (`std::unique_ptr`, `std::shared_ptr`) ì‚¬ìš©
- **ìŠ¤ë ˆë“œ ì•ˆì „**: `std::mutex`, `std::atomic` ëª…ì‹œì  ì‚¬ìš©

### UI ê°œë°œ ê·œì¹™
1. **Qt Designerì—ì„œë§Œ UI ìƒì„±** (`.ui` íŒŒì¼)
2. C++ ì½”ë“œëŠ” **ë¡œì§ê³¼ ì‹œê·¸ë„/ìŠ¬ë¡¯ ì—°ê²°ë§Œ** ë‹´ë‹¹
3. UI ìŠ¤ë ˆë“œì—ì„œ **ë¸”ë¡œí‚¹ ì‘ì—… ê¸ˆì§€** (OCR, ë„¤íŠ¸ì›Œí¬ ë“±)

### ë¡œê¹… ì •ì±…
- **spdlog** ì‚¬ìš©
- ë ˆë²¨:
  - `trace`: í”„ë ˆì„ë³„ ìƒì„¸ ì •ë³´
  - `debug`: ë””ë²„ê¹…ìš© ì¤‘ê°„ ê²°ê³¼
  - `info`: ì£¼ìš” ì´ë²¤íŠ¸ (OCR ì™„ë£Œ, Anki ì¶”ê°€ ë“±)
  - `warn`: ë³µêµ¬ ê°€ëŠ¥í•œ ì—ëŸ¬ (GDI í´ë°±)
  - `error`: ì¹˜ëª…ì  ì—ëŸ¬

---

## í…ŒìŠ¤íŠ¸ ìš”êµ¬ì‚¬í•­

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Google Test)

| ëª¨ë“ˆ | í…ŒìŠ¤íŠ¸ í•­ëª© |
|------|-------------|
| `FrameQueue` | Push/Pop ë™ê¸°í™”, ì˜¤ë²„í”Œë¡œìš° ì²˜ë¦¬ |
| `TesseractWrapper` | ì¼ë³¸ì–´ í…ìŠ¤íŠ¸ ì¶”ì¶œ ì •í™•ë„ |
| `JapaneseTokenizer` | í•œì/íˆë¼ê°€ë‚˜ ë¶„ë¦¬ |
| `Dictionary` | JSON ë¡œë“œ, ë‹¨ì–´ ê²€ìƒ‰ |
| `AnkiConnectClient` | HTTP ìš”ì²­ ìƒì„± (Mock) |

### í†µí•© í…ŒìŠ¤íŠ¸

| ì‹œë‚˜ë¦¬ì˜¤ | ì„±ê³µ ê¸°ì¤€ |
|----------|-----------|
| í™”ë©´ ìº¡ì²˜ â†’ OCR â†’ ì˜¤ë²„ë ˆì´ | ë ˆì´í„´ì‹œ â‰¤ 200ms |
| ë™ì¼ í”„ë ˆì„ ìŠ¤í‚µ | OCR í˜¸ì¶œ ì•ˆ ë¨ |
| ì•±ì—ì„œ ë‹¨ì–´ í´ë¦­ â†’ ì‚¬ì „ í‘œì‹œ | 1ì´ˆ ë‚´ ì‘ë‹µ |
| Anki ì¹´ë“œ ì¶”ê°€ | HTTP 200, ì¹´ë“œ ìƒì„± í™•ì¸ |

### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

- **ë²¤ì¹˜ë§ˆí¬ ë„êµ¬**: Google Benchmark
- **ì¸¡ì • ëŒ€ìƒ**:
  - DXGI ìº¡ì²˜ FPS
  - Tesseract OCR ì²˜ë¦¬ ì‹œê°„
  - í”„ë ˆì„ ë³€ê²½ ê°ì§€ ì‹œê°„

---

## ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­

### ë³´ì•ˆ
- **ë¡œì»¬ ì „ìš©**: ë„¤íŠ¸ì›Œí¬ í†µì‹ ì€ `localhost` (AnkiConnect)ë§Œ
- **ì…ë ¥ ê²€ì¦**: ì‚¬ìš©ì ì œê³µ `.ui` íŒŒì¼ íŒŒì‹± ì‹œ ì˜ˆì™¸ ì²˜ë¦¬

### ìœ ì§€ë³´ìˆ˜ì„±
- **ëª¨ë“ˆí™”**: ê° ëª¨ë“ˆ ë…ë¦½ ì»´íŒŒì¼ ê°€ëŠ¥
- **ì¸í„°í˜ì´ìŠ¤ ì¶”ìƒí™”**: ê°€ìƒ í´ë˜ìŠ¤ë¡œ í…ŒìŠ¤íŠ¸ Mock ì§€ì›

### í™•ì¥ì„±
- **í”ŒëŸ¬ê·¸ì¸ êµ¬ì¡°**: í–¥í›„ ë‹¤ë¥¸ OCR ì—”ì§„ êµì²´ ê°€ëŠ¥ (ì¸í„°í˜ì´ìŠ¤ ìœ ì§€)
- **ì–¸ì–´ ì§€ì›**: í•œìâ†’ì½ê¸° ë§¤í¼ë¥¼ ì¤‘êµ­ì–´ë¡œ í™•ì¥ ê°€ëŠ¥

### ë°°í¬
- **íŒ¨í‚¤ì§•**: Tesseract ëª¨ë¸ íŒŒì¼ (`jpn.traineddata`) í¬í•¨
- **ì˜ì¡´ì„±**: Qt, OpenCVëŠ” ì •ì  ë§í¬ ë˜ëŠ” installerì— í¬í•¨

---

## ê°œë°œ ìš°ì„ ìˆœìœ„ (MVP)

### Phase 1: Core Pipeline (1-2ì£¼)
1. âœ… DXGI í™”ë©´ ìº¡ì²˜
2. âœ… FrameQueue êµ¬í˜„
3. âœ… Tesseract OCR í†µí•©
4. âœ… ê¸°ë³¸ ì˜¤ë²„ë ˆì´ ì°½ (í…ìŠ¤íŠ¸ í‘œì‹œë§Œ)

### Phase 2: Furigana & Tokenization (1-2ì£¼)
5. âœ… ì¼ë³¸ì–´ í† í¬ë‚˜ì´ì € (MeCab ë˜ëŠ” ì‚¬ì „ ê¸°ë°˜)
6. âœ… í›„ë¦¬ê°€ë‚˜ ë§¤í•‘ ë° ë Œë”ë§

### Phase 3: Desktop App (1ì£¼)
7. âœ… Qt Designer UI ë¡œë“œ
8. âœ… ë¬¸ì¥ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ
9. âœ… ë‹¨ì–´ í˜¸ë²„/í´ë¦­ ì²˜ë¦¬

### Phase 4: Dictionary & Anki (1ì£¼)
10. âœ… ë¡œì»¬ ì‚¬ì „ ë¡œë“œ
11. âœ… AnkiConnect í´ë¼ì´ì–¸íŠ¸
12. âœ… ì¹´ë“œ ì¶”ê°€ ë²„íŠ¼ ë™ì‘

### Phase 5: Polish & Testing (1ì£¼)
13. âœ… ì„±ëŠ¥ ìµœì í™” (ë³€ê²½ ê°ì§€, OCR ìŠ¤í‚µ)
14. âœ… ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…
15. âœ… ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

---

## ì°¸ê³  ë¬¸ì„œ
- [Code Style Guide](./code-style.md)
- [Qt Designer Manual](https://doc.qt.io/qt-6/qtdesigner-manual.html)
- [Tesseract API Documentation](https://tesseract-ocr.github.io/tessapi/5.x/)
- [AnkiConnect API](https://git.foosoft.net/alex/anki-connect)

---

**ë³€ê²½ ì´ë ¥**
- **1.0** (2025-11-10): ì´ˆì•ˆ ì‘ì„±
